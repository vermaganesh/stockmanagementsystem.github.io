import { __awaiter, __decorate, __metadata } from "tslib";
import { Component, ElementRef, Input, Output, EventEmitter } from '@angular/core';
import { GoogleChartsLoaderService } from '../google-charts-loader.service';
import { GoogleChartsDataTable } from '../google-charts-datatable';
import { ChartHTMLTooltip } from './chart-html-tooltip';
let GoogleChartComponent = class GoogleChartComponent {
    constructor(el, loaderService) {
        this.el = el;
        this.loaderService = loaderService;
        this.mouseOverListener = (item) => {
            const event = this.parseMouseEvent(item);
            event.tooltip = this.getHTMLTooltip();
            return event;
        };
        this.mouseOutListener = (item) => {
            const event = this.parseMouseEvent(item);
            return event;
        };
        this.selectListener = () => {
            const event = {
                message: 'select',
                row: null,
                column: null,
                selectedRowValues: [],
                selectedRowFormattedValues: [],
                columnLabel: ''
            };
            const s = this.wrapper.visualization.getSelection();
            const gs = s[s.length - 1];
            if (!gs) {
                event.message = 'deselect';
                return event;
            }
            const selection = gs;
            if (gs.row != null) {
                event.row = selection.row;
                const selectedRowValues = [];
                const selectedRowFormattedValues = [];
                const dataTable = this.wrapper.getDataTable();
                const numberOfColumns = dataTable.getNumberOfColumns();
                for (let i = 0; i < numberOfColumns; i++) {
                    selectedRowValues.push(dataTable.getValue(selection.row, i));
                    selectedRowFormattedValues.push(dataTable.getFormattedValue(selection.row, i));
                }
                event.selectedRowValues = selectedRowValues;
                event.selectedRowFormattedValues = selectedRowFormattedValues;
            }
            if (selection.column != null) {
                event.column = selection.column;
                event.columnLabel = this.getColumnLabelAtPosition(selection);
            }
            if (gs.name) {
                event.columnLabel = gs.name;
            }
            return event;
        };
        this.chartSelect = new EventEmitter();
        this.chartSelectOneTime = new EventEmitter();
        this.chartReady = new EventEmitter();
        this.chartReadyOneTime = new EventEmitter();
        this.chartError = new EventEmitter();
        this.chartErrorOneTime = new EventEmitter();
        this.mouseOver = new EventEmitter();
        this.mouseOverOneTime = new EventEmitter();
        this.mouseOut = new EventEmitter();
        this.mouseOutOneTime = new EventEmitter();
        this.regionClick = new EventEmitter();
        this.regionClickOneTime = new EventEmitter();
    }
    ngOnInit() {
        this.HTMLel = this.el.nativeElement.querySelector('div');
        if (Object.isExtensible(this.data)) {
            this.data.component = this;
        }
        this.options = this.data.options;
        this.init().then(() => {
            this.draw();
        });
    }
    init() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this.loaderService.load();
            this.recreateWrapper();
        });
    }
    recreateWrapper() {
        if (this.wrapper === undefined || this.wrapper.getChartType() !== this.data.chartType) {
            this.dataTable = new GoogleChartsDataTable(this.data);
            this.dataTable.dataTableChanged.subscribe((dt) => {
                this._draw();
            });
            // see dataTable in https://developers.google.com/chart/interactive/docs/reference#google.visualization.drawchart
            let temp = this.data;
            if (this.data.firstRowIsData) {
                temp = Object.assign(temp, this.data);
                temp.dataTable = this.dataTable.getDataTable();
            }
            this.wrapper = new google.visualization.ChartWrapper(temp);
            this.registerChartWrapperEvents();
            /* Calling draw even without data is the only way to pass the HTMl element
               when using the chart in a dashboard. Don't do this in all other cases:
               it breaks formatters with remote data source, hence the conditional. */
            if (temp.dataTable === undefined && temp.dataSourceUrl === undefined) {
                try {
                    this.wrapper.draw(this.HTMLel);
                }
                catch (err) { }
            }
        }
    }
    _draw() {
        return __awaiter(this, void 0, void 0, function* () {
            const dt = this.dataTable.getDataTable();
            if (dt === undefined) {
                return;
            }
            this.convertOptions();
            this.recreateWrapper();
            this.wrapper.setOptions(this.options);
            this.wrapper.setDataTable(dt);
            this.wrapper.draw(this.HTMLel);
        });
    }
    getDataTable() {
        return this.dataTable;
    }
    draw(value) {
        if (value === undefined) {
            value = this.data;
        }
        this.options = value.options;
        this.dataTable.init(value);
    }
    getSelectorBySeriesType(seriesType) {
        const selectors = {
            bars: 'bar#%s#%r',
            haxis: 'hAxis#0#label',
            line: 'point#%s#%r',
            legend: 'legendentry#%s',
            area: 'point#%s#%r'
        };
        const selector = selectors[seriesType];
        return selector;
    }
    /**
     * Given a column number, counts how many
     * columns have rol=="data". Those are mapped
     * one-to-one to the series array. When rol is not defined
     * a column of type number means a series column.
     * @param column to inspect
     */
    getSeriesByColumn(column) {
        let series = 0;
        const dataTable = this.wrapper.getDataTable();
        for (let i = column - 1; i >= 0; i--) {
            const role = dataTable.getColumnRole(i);
            const type = dataTable.getColumnType(i);
            if (role === 'data' || type === 'number') {
                series++;
            }
        }
        return series;
    }
    getBoundingBoxForItem(item) {
        let boundingBox = { top: 0, left: 0, width: 0, height: 0 };
        if (this.cli) {
            const column = item.column;
            const series = this.getSeriesByColumn(column);
            const row = item.row;
            let seriesType = this.options.seriesType;
            if (this.options.series && this.options.series[series] && this.options.series[series].type) {
                seriesType = this.options.series[series].type;
            }
            if (seriesType) {
                let selector = this.getSelectorBySeriesType(seriesType);
                if (selector) {
                    selector = selector.replace('%s', series + '').replace('%c', column + '').replace('%r', row + '');
                    const box = this.cli.getBoundingBox(selector);
                    if (box) {
                        boundingBox = box;
                    }
                }
            }
        }
        return boundingBox;
    }
    getValueAtPosition(position) {
        if (position.row == null) {
            return null;
        }
        const dataTable = this.wrapper.getDataTable();
        const value = dataTable.getValue(position.row, position.column);
        return value;
    }
    getColumnTypeAtPosition(position) {
        const dataTable = this.wrapper.getDataTable();
        const type = dataTable.getColumnType(position.column) || '';
        return type;
    }
    getColumnLabelAtPosition(position) {
        const dataTable = this.wrapper.getDataTable();
        const type = dataTable.getColumnLabel(position.column) || '';
        return type;
    }
    getHTMLTooltip() {
        const tooltipER = new ElementRef(this.el.nativeElement.querySelector('.google-visualization-tooltip'));
        return new ChartHTMLTooltip(tooltipER);
    }
    parseMouseEvent(item) {
        const chartType = this.wrapper.getChartType();
        let eventColumn = item.column;
        if (eventColumn == null) {
            switch (chartType) {
                case 'Timeline':
                    eventColumn = this.wrapper.getDataTable().getNumberOfColumns() === 3 ? 0 : 1;
                    break;
                default:
                    eventColumn = 0;
            }
        }
        const eventRow = item.row;
        const myItem = {
            row: eventRow,
            column: eventColumn
        };
        const event = {
            position: item,
            boundingBox: this.getBoundingBoxForItem(myItem),
            value: this.getValueAtPosition(myItem),
            columnType: this.getColumnTypeAtPosition(myItem),
            columnLabel: this.getColumnLabelAtPosition(myItem)
        };
        return event;
    }
    unregisterEvents() {
        google.visualization.events.removeAllListeners(this.wrapper.getChart());
        google.visualization.events.removeAllListeners(this.wrapper);
    }
    registerChartEvents() {
        const chart = this.wrapper.getChart();
        this.cli = chart.getChartLayoutInterface ? chart.getChartLayoutInterface() : null;
        if (this.mouseOver.observers.length > 0) {
            google.visualization.events.addListener(chart, 'onmouseover', (item) => {
                const event = this.parseMouseEvent(item);
                event.tooltip = this.getHTMLTooltip();
                this.mouseOver.emit(event);
            });
        }
        if (this.mouseOverOneTime.observers.length > 0) {
            google.visualization.events.addOneTimeListener(chart, 'onmouseover', (item) => {
                const event = this.parseMouseEvent(item);
                event.tooltip = this.getHTMLTooltip();
                this.mouseOverOneTime.emit(event);
            });
        }
        if (this.mouseOut.observers.length > 0) {
            google.visualization.events.addListener(chart, 'onmouseout', (item) => {
                const event = this.parseMouseEvent(item);
                this.mouseOut.emit(event);
            });
        }
        if (this.mouseOutOneTime.observers.length > 0) {
            google.visualization.events.addOneTimeListener(chart, 'onmouseout', (item) => {
                const event = this.parseMouseEvent(item);
                this.mouseOutOneTime.emit(event);
            });
        }
        if (this.data.chartType === 'GeoChart') {
            if (this.regionClick.observers.length > 0) {
                google.visualization.events.addListener(chart, 'regionClick', (item) => {
                    this.regionClick.emit(item);
                });
            }
            if (this.regionClickOneTime.observers.length > 0) {
                google.visualization.events.addOneTimeListener(chart, 'regionClick', (item) => {
                    this.regionClick.emit(item);
                });
            }
        }
    }
    registerChartWrapperEvents() {
        google.visualization.events.addListener(this.wrapper, 'ready', () => {
            this.chartReady.emit({ message: 'Chart ready' });
        });
        google.visualization.events.addOneTimeListener(this.wrapper, 'ready', () => {
            this.chartReadyOneTime.emit({ message: 'Chart ready (one time)' });
            this.registerChartEvents();
        });
        google.visualization.events.addListener(this.wrapper, 'error', (error) => {
            this.chartError.emit(error);
        });
        google.visualization.events.addOneTimeListener(this.wrapper, 'error', (error) => {
            this.chartErrorOneTime.emit(error);
        });
        this.addListener(this.wrapper, 'select', this.selectListener, this.chartSelect);
        this.addOneTimeListener(this.wrapper, 'select', this.selectListener, this.chartSelectOneTime);
    }
    addListener(source, eventType, listenerFn, evEmitter) {
        google.visualization.events.addListener(source, eventType, () => {
            evEmitter.emit(listenerFn());
        });
    }
    addOneTimeListener(source, eventType, listenerFn, evEmitter) {
        google.visualization.events.addOneTimeListener(source, eventType, () => {
            evEmitter.emit(listenerFn());
        });
    }
    convertOptions() {
        try {
            this.options = google.charts[this.data.chartType].convertOptions(this.options);
        }
        catch (error) {
            return;
        }
    }
};
__decorate([
    Input(),
    __metadata("design:type", Object)
], GoogleChartComponent.prototype, "data", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "chartReady", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "chartReadyOneTime", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "chartError", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "chartErrorOneTime", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "chartSelect", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "chartSelectOneTime", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "mouseOver", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "mouseOverOneTime", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "mouseOut", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "mouseOutOneTime", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "regionClick", void 0);
__decorate([
    Output(),
    __metadata("design:type", EventEmitter)
], GoogleChartComponent.prototype, "regionClickOneTime", void 0);
GoogleChartComponent = __decorate([
    Component({
        selector: 'google-chart',
        template: '<div></div>'
    }),
    __metadata("design:paramtypes", [ElementRef,
        GoogleChartsLoaderService])
], GoogleChartComponent);
export { GoogleChartComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ29vZ2xlLWNoYXJ0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25nMi1nb29nbGUtY2hhcnRzL3NyYy9saWIvZ29vZ2xlLWNoYXJ0L2dvb2dsZS1jaGFydC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUVBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsVUFBVSxFQUVWLEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUNiLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQzVFLE9BQU8sRUFBRSxxQkFBcUIsRUFBa0MsTUFBTSw0QkFBNEIsQ0FBQztBQVduRyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQWN4RCxJQUFhLG9CQUFvQixHQUFqQyxNQUFhLG9CQUFvQjtJQTZCL0IsWUFBMkIsRUFBYyxFQUNkLGFBQXdDO1FBRHhDLE9BQUUsR0FBRixFQUFFLENBQVk7UUFDZCxrQkFBYSxHQUFiLGFBQWEsQ0FBMkI7UUF3UjNELHNCQUFpQixHQUFHLENBQUMsSUFBdUIsRUFBRSxFQUFFO1lBQ3RELE1BQU0sS0FBSyxHQUF3QixJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBd0IsQ0FBQztZQUNyRixLQUFLLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUN0QyxPQUFPLEtBQUssQ0FBQztRQUNmLENBQUMsQ0FBQTtRQUVPLHFCQUFnQixHQUFHLENBQUMsSUFBdUIsRUFBRSxFQUFFO1lBQ3JELE1BQU0sS0FBSyxHQUF1QixJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBdUIsQ0FBQztZQUNuRixPQUFPLEtBQUssQ0FBQztRQUNmLENBQUMsQ0FBQTtRQUVPLG1CQUFjLEdBQUcsR0FBRyxFQUFFO1lBQzVCLE1BQU0sS0FBSyxHQUFxQjtnQkFDOUIsT0FB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QixZQUFZOytEQUFrQjtBQUV4RDtJQUFULE1BQU0sRUFBRTs4QkFBb0IsWUFBWTt3REFBa0I7QUFDakQ7SUFBVCxNQUFNLEVBQUU7OEJBQTJCLFlBQVk7K0RBQWtCO0FBRXhEO0lBQVQsTUFBTSxFQUFFOzhCQUFxQixZQUFZO3lEQUFtQjtBQUNuRDtJQUFULE1BQU0sRUFBRTs4QkFBNEIsWUFBWTtnRUFBbUI7QUFFMUQ7SUFBVCxNQUFNLEVBQUU7OEJBQW1CLFlBQVk7dURBQXNCO0FBQ3BEO0lBQVQsTUFBTSxFQUFFOzhCQUEwQixZQUFZOzhEQUFzQjtBQUUzRDtJQUFULE1BQU0sRUFBRTs4QkFBa0IsWUFBWTtzREFBcUI7QUFDbEQ7SUFBVCxNQUFNLEVBQUU7OEJBQXlCLFlBQVk7NkRBQXFCO0FBRXpEO0lBQVQsTUFBTSxFQUFFOzhCQUFxQixZQUFZO3lEQUFtQjtBQUNuRDtJQUFULE1BQU0sRUFBRTs4QkFBNEIsWUFBWTtnRUFBbUI7QUFwQnpELG9CQUFvQjtJQUpoQyxTQUFTLENBQUM7UUFDVCxRQUFRLEVBQUUsY0FBYztRQUN4QixRQUFRLEVBQUUsYUFBYTtLQUN4QixDQUFDO3FDQThCK0IsVUFBVTtRQUNDLHlCQUF5QjtHQTlCeEQsb0JBQW9CLENBaVhoQztTQWpYWSxvQkFBb0IiLCJzb3VyY2VzQ29udGVudCI6WyJkZWNsYXJlIHZhciBnb29nbGU6IGFueTtcblxuaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBPbkluaXQsXG4gIElucHV0LFxuICBPdXRwdXQsXG4gIEV2ZW50RW1pdHRlclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgR29vZ2xlQ2hhcnRzTG9hZGVyU2VydmljZSB9IGZyb20gJy4uL2dvb2dsZS1jaGFydHMtbG9hZGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgR29vZ2xlQ2hhcnRzRGF0YVRhYmxlLCBHb29nbGVDaGFydHNEYXRhVGFibGVJbnRlcmZhY2UgfSBmcm9tICcuLi9nb29nbGUtY2hhcnRzLWRhdGF0YWJsZSc7XG5pbXBvcnQgeyBDaGFydFJlYWR5RXZlbnQgfSBmcm9tICcuL2NoYXJ0LXJlYWR5LWV2ZW50JztcbmltcG9ydCB7IENoYXJ0RXJyb3JFdmVudCB9IGZyb20gJy4vY2hhcnQtZXJyb3ItZXZlbnQnO1xuaW1wb3J0IHsgQ2hhcnRTZWxlY3RFdmVudCB9IGZyb20gJy4vY2hhcnQtc2VsZWN0LWV2ZW50JztcbmltcG9ydCB7XG4gIENoYXJ0TW91c2VFdmVudCxcbiAgQ2hhcnRNb3VzZU92ZXJFdmVudCxcbiAgQ2hhcnRNb3VzZU91dEV2ZW50LFxuICBCb3VuZGluZ0JveCxcbiAgRGF0YVBvaW50UG9zaXRpb25cbn0gZnJvbSAnLi9jaGFydC1tb3VzZS1ldmVudCc7XG5pbXBvcnQgeyBDaGFydEhUTUxUb29sdGlwIH0gZnJvbSAnLi9jaGFydC1odG1sLXRvb2x0aXAnO1xuaW1wb3J0IHsgUmVnaW9uQ2xpY2tFdmVudCB9IGZyb20gJy4vZ2VvY2hhcnQtZXZlbnRzJztcblxuZXhwb3J0IGludGVyZmFjZSBHb29nbGVDaGFydEludGVyZmFjZSBleHRlbmRzIEdvb2dsZUNoYXJ0c0RhdGFUYWJsZUludGVyZmFjZSB7XG4gIGNoYXJ0VHlwZTogc3RyaW5nO1xuICBvcHRpb25zPzogYW55O1xuXG4gIGNvbXBvbmVudD86IEdvb2dsZUNoYXJ0Q29tcG9uZW50O1xufVxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdnb29nbGUtY2hhcnQnLFxuICB0ZW1wbGF0ZTogJzxkaXY+PC9kaXY+Jyxcbn0pXG5leHBvcnQgY2xhc3MgR29vZ2xlQ2hhcnRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIEBJbnB1dCgpIHB1YmxpYyBkYXRhOiBHb29nbGVDaGFydEludGVyZmFjZTtcblxuICBAT3V0cHV0KCkgcHVibGljIGNoYXJ0UmVhZHk6IEV2ZW50RW1pdHRlcjxDaGFydFJlYWR5RXZlbnQ+O1xuICBAT3V0cHV0KCkgcHVibGljIGNoYXJ0UmVhZHlPbmVUaW1lOiBFdmVudEVtaXR0ZXI8Q2hhcnRSZWFkeUV2ZW50PjtcblxuICBAT3V0cHV0KCkgcHVibGljIGNoYXJ0RXJyb3I6IEV2ZW50RW1pdHRlcjxDaGFydEVycm9yRXZlbnQ+O1xuICBAT3V0cHV0KCkgcHVibGljIGNoYXJ0RXJyb3JPbmVUaW1lOiBFdmVudEVtaXR0ZXI8Q2hhcnRFcnJvckV2ZW50PjtcblxuICBAT3V0cHV0KCkgcHVibGljIGNoYXJ0U2VsZWN0OiBFdmVudEVtaXR0ZXI8Q2hhcnRTZWxlY3RFdmVudD47XG4gIEBPdXRwdXQoKSBwdWJsaWMgY2hhcnRTZWxlY3RPbmVUaW1lOiBFdmVudEVtaXR0ZXI8Q2hhcnRTZWxlY3RFdmVudD47XG5cbiAgQE91dHB1dCgpIHB1YmxpYyBtb3VzZU92ZXI6IEV2ZW50RW1pdHRlcjxDaGFydE1vdXNlT3ZlckV2ZW50PjtcbiAgQE91dHB1dCgpIHB1YmxpYyBtb3VzZU92ZXJPbmVUaW1lOiBFdmVudEVtaXR0ZXI8Q2hhcnRNb3VzZU92ZXJFdmVudD47XG5cbiAgQE91dHB1dCgpIHB1YmxpYyBtb3VzZU91dDogRXZlbnRFbWl0dGVyPENoYXJ0TW91c2VPdXRFdmVudD47XG4gIEBPdXRwdXQoKSBwdWJsaWMgbW91c2VPdXRPbmVUaW1lOiBFdmVudEVtaXR0ZXI8Q2hhcnRNb3VzZU91dEV2ZW50PjtcblxuICBAT3V0cHV0KCkgcHVibGljIHJlZ2lvbkNsaWNrOiBFdmVudEVtaXR0ZXI8UmVnaW9uQ2xpY2tFdmVudD47XG4gIEBPdXRwdXQoKSBwdWJsaWMgcmVnaW9uQ2xpY2tPbmVUaW1lOiBFdmVudEVtaXR0ZXI8UmVnaW9uQ2xpY2tFdmVudD47XG5cbiAgcHVibGljIHdyYXBwZXI6IGFueTtcbiAgcHJpdmF0ZSBjbGk6IGFueTtcbiAgcHJpdmF0ZSBvcHRpb25zOiBhbnk7XG5cbiAgcHJpdmF0ZSBIVE1MZWw6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIGRhdGFUYWJsZTogR29vZ2xlQ2hhcnRzRGF0YVRhYmxlO1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsOiBFbGVtZW50UmVmLFxuICAgICAgICAgICAgICAgICAgICAgcHJpdmF0ZSBsb2FkZXJTZXJ2aWNlOiBHb29nbGVDaGFydHNMb2FkZXJTZXJ2aWNlKSB7XG4gICAgdGhpcy5jaGFydFNlbGVjdCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLmNoYXJ0U2VsZWN0T25lVGltZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLmNoYXJ0UmVhZHkgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgdGhpcy5jaGFydFJlYWR5T25lVGltZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLmNoYXJ0RXJyb3IgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgdGhpcy5jaGFydEVycm9yT25lVGltZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLm1vdXNlT3ZlciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLm1vdXNlT3Zlck9uZVRpbWUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgdGhpcy5tb3VzZU91dCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLm1vdXNlT3V0T25lVGltZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICB0aGlzLnJlZ2lvbkNsaWNrID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIHRoaXMucmVnaW9uQ2xpY2tPbmVUaW1lID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICB9XG5cbiAgcHVibGljIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuSFRNTGVsID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2RpdicpO1xuICAgIGlmIChPYmplY3QuaXNFeHRlbnNpYmxlKHRoaXMuZGF0YSkpIHtcbiAgICAgIHRoaXMuZGF0YS5jb21wb25lbnQgPSB0aGlzO1xuICAgIH1cbiAgICB0aGlzLm9wdGlvbnMgPSB0aGlzLmRhdGEub3B0aW9ucztcblxuICAgIHRoaXMuaW5pdCgpLnRoZW4oKCkgPT4ge1xuICAgICAgdGhpcy5kcmF3KCk7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgaW5pdCgpIHtcbiAgICBhd2FpdCB0aGlzLmxvYWRlclNlcnZpY2UubG9hZCgpO1xuICAgIHRoaXMucmVjcmVhdGVXcmFwcGVyKCk7XG4gIH1cblxuICBwcml2YXRlIHJlY3JlYXRlV3JhcHBlcigpIHtcbiAgICBpZiAodGhpcy53cmFwcGVyID09PSB1bmRlZmluZWQgfHwgdGhpcy53cmFwcGVyLmdldENoYXJ0VHlwZSgpICE9PSB0aGlzLmRhdGEuY2hhcnRUeXBlKSB7XG4gICAgICB0aGlzLmRhdGFUYWJsZSA9IG5ldyBHb29nbGVDaGFydHNEYXRhVGFibGUodGhpcy5kYXRhKTtcbiAgICAgIHRoaXMuZGF0YVRhYmxlLmRhdGFUYWJsZUNoYW5nZWQuc3Vic2NyaWJlKChkdDogYW55KSA9PiB7XG4gICAgICAgIHRoaXMuX2RyYXcoKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBzZWUgZGF0YVRhYmxlIGluIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2NoYXJ0L2ludGVyYWN0aXZlL2RvY3MvcmVmZXJlbmNlI2dvb2dsZS52aXN1YWxpemF0aW9uLmRyYXdjaGFydFxuICAgICAgbGV0IHRlbXA6IEdvb2dsZUNoYXJ0SW50ZXJmYWNlID0gdGhpcy5kYXRhO1xuICAgICAgaWYgKHRoaXMuZGF0YS5maXJzdFJvd0lzRGF0YSkge1xuICAgICAgICB0ZW1wID0gT2JqZWN0LmFzc2lnbih0ZW1wLCB0aGlzLmRhdGEpO1xuICAgICAgICB0ZW1wLmRhdGFUYWJsZSA9IHRoaXMuZGF0YVRhYmxlLmdldERhdGFUYWJsZSgpO1xuICAgICAgfVxuICAgICAgdGhpcy53cmFwcGVyID0gbmV3IGdvb2dsZS52aXN1YWxpemF0aW9uLkNoYXJ0V3JhcHBlcih0ZW1wKTtcbiAgICAgIHRoaXMucmVnaXN0ZXJDaGFydFdyYXBwZXJFdmVudHMoKTtcblxuICAgICAgLyogQ2FsbGluZyBkcmF3IGV2ZW4gd2l0aG91dCBkYXRhIGlzIHRoZSBvbmx5IHdheSB0byBwYXNzIHRoZSBIVE1sIGVsZW1lbnRcbiAgICAgICAgIHdoZW4gdXNpbmcgdGhlIGNoYXJ0IGluIGEgZGFzaGJvYXJkLiBEb24ndCBkbyB0aGlzIGluIGFsbCBvdGhlciBjYXNlczpcbiAgICAgICAgIGl0IGJyZWFrcyBmb3JtYXR0ZXJzIHdpdGggcmVtb3RlIGRhdGEgc291cmNlLCBoZW5jZSB0aGUgY29uZGl0aW9uYWwuICovXG4gICAgICBpZiAodGVtcC5kYXRhVGFibGUgPT09IHVuZGVmaW5lZCAmJiB0ZW1wLmRhdGFTb3VyY2VVcmwgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHRoaXMud3JhcHBlci5kcmF3KHRoaXMuSFRNTGVsKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7fVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgX2RyYXcoKSB7XG4gICAgY29uc3QgZHQgPSB0aGlzLmRhdGFUYWJsZS5nZXREYXRhVGFibGUoKTtcbiAgICBpZiAoZHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmNvbnZlcnRPcHRpb25zKCk7XG4gICAgdGhpcy5yZWNyZWF0ZVdyYXBwZXIoKTtcbiAgICB0aGlzLndyYXBwZXIuc2V0T3B0aW9ucyh0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMud3JhcHBlci5zZXREYXRhVGFibGUoZHQpO1xuICAgIHRoaXMud3JhcHBlci5kcmF3KHRoaXMuSFRNTGVsKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXREYXRhVGFibGUoKTogR29vZ2xlQ2hhcnRzRGF0YVRhYmxlIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhVGFibGU7XG4gIH1cblxuICBwdWJsaWMgZHJhdyh2YWx1ZT86IEdvb2dsZUNoYXJ0SW50ZXJmYWNlKSB7XG4gICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHZhbHVlID0gdGhpcy5kYXRhO1xuICAgIH1cbiAgICB0aGlzLm9wdGlvbnMgPSB2YWx1ZS5vcHRpb25zO1xuICAgIHRoaXMuZGF0YVRhYmxlLmluaXQodmFsdWUpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTZWxlY3RvckJ5U2VyaWVzVHlwZShzZXJpZXNUeXBlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHNlbGVjdG9yczogYW55ID0ge1xuICAgICAgYmFycyA6ICdiYXIjJXMjJXInLFxuICAgICAgaGF4aXMgOiAnaEF4aXMjMCNsYWJlbCcsXG4gICAgICBsaW5lOiAncG9pbnQjJXMjJXInLFxuICAgICAgbGVnZW5kIDogJ2xlZ2VuZGVudHJ5IyVzJyxcbiAgICAgIGFyZWE6ICdwb2ludCMlcyMlcidcbiAgICB9O1xuXG4gICAgY29uc3Qgc2VsZWN0b3I6IHN0cmluZyA9IHNlbGVjdG9yc1tzZXJpZXNUeXBlXTtcblxuICAgIHJldHVybiBzZWxlY3RvcjtcbiAgfVxuXG4gLyoqXG4gICogR2l2ZW4gYSBjb2x1bW4gbnVtYmVyLCBjb3VudHMgaG93IG1hbnlcbiAgKiBjb2x1bW5zIGhhdmUgcm9sPT1cImRhdGFcIi4gVGhvc2UgYXJlIG1hcHBlZFxuICAqIG9uZS10by1vbmUgdG8gdGhlIHNlcmllcyBhcnJheS4gV2hlbiByb2wgaXMgbm90IGRlZmluZWRcbiAgKiBhIGNvbHVtbiBvZiB0eXBlIG51bWJlciBtZWFucyBhIHNlcmllcyBjb2x1bW4uXG4gICogQHBhcmFtIGNvbHVtbiB0byBpbnNwZWN0XG4gICovXG4gIHByaXZhdGUgZ2V0U2VyaWVzQnlDb2x1bW4oY29sdW1uOiBudW1iZXIpOiBudW1iZXIgIHtcbiAgICBsZXQgc2VyaWVzID0gMDtcbiAgICBjb25zdCBkYXRhVGFibGUgPSB0aGlzLndyYXBwZXIuZ2V0RGF0YVRhYmxlKCk7XG4gICAgZm9yIChsZXQgaSA9IGNvbHVtbiAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBjb25zdCByb2xlID0gZGF0YVRhYmxlLmdldENvbHVtblJvbGUoaSk7XG4gICAgICBjb25zdCB0eXBlID0gZGF0YVRhYmxlLmdldENvbHVtblR5cGUoaSk7XG4gICAgICBpZiAocm9sZSA9PT0gJ2RhdGEnIHx8IHR5cGUgPT09ICdudW1iZXInKSB7XG4gICAgICAgIHNlcmllcysrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gc2VyaWVzO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRCb3VuZGluZ0JveEZvckl0ZW0oaXRlbTogRGF0YVBvaW50UG9zaXRpb24pOiBCb3VuZGluZ0JveCB7XG4gICAgbGV0IGJvdW5kaW5nQm94ID0ge3RvcDogMCwgbGVmdDogMCwgd2lkdGg6IDAsIGhlaWdodDogMH07XG4gICAgaWYgKHRoaXMuY2xpKSB7XG4gICAgICBjb25zdCBjb2x1bW4gPSBpdGVtLmNvbHVtbjtcbiAgICAgIGNvbnN0IHNlcmllcyA9IHRoaXMuZ2V0U2VyaWVzQnlDb2x1bW4oY29sdW1uKTtcbiAgICAgIGNvbnN0IHJvdyA9IGl0ZW0ucm93O1xuICAgICAgbGV0IHNlcmllc1R5cGUgPSB0aGlzLm9wdGlvbnMuc2VyaWVzVHlwZTtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2VyaWVzICYmIHRoaXMub3B0aW9ucy5zZXJpZXNbc2VyaWVzXSAmJiB0aGlzLm9wdGlvbnMuc2VyaWVzW3Nlcmllc10udHlwZSkge1xuICAgICAgICBzZXJpZXNUeXBlID0gdGhpcy5vcHRpb25zLnNlcmllc1tzZXJpZXNdLnR5cGU7XG4gICAgICB9XG4gICAgICBpZiAoc2VyaWVzVHlwZSkge1xuICAgICAgICBsZXQgc2VsZWN0b3IgPSB0aGlzLmdldFNlbGVjdG9yQnlTZXJpZXNUeXBlKHNlcmllc1R5cGUpO1xuICAgICAgICBpZiAoc2VsZWN0b3IpIHtcbiAgICAgICAgICAgICBzZWxlY3RvciA9IHNlbGVjdG9yLnJlcGxhY2UoJyVzJywgc2VyaWVzICsgJycpLnJlcGxhY2UoJyVjJywgY29sdW1uICsgJycpLnJlcGxhY2UoJyVyJywgcm93ICsgJycpO1xuICAgICAgICAgICAgIGNvbnN0IGJveCA9IHRoaXMuY2xpLmdldEJvdW5kaW5nQm94KHNlbGVjdG9yKTtcbiAgICAgICAgICAgICBpZiAoYm94KSB7XG4gICAgICAgICAgICAgIGJvdW5kaW5nQm94ID0gYm94O1xuICAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBib3VuZGluZ0JveDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VmFsdWVBdFBvc2l0aW9uKHBvc2l0aW9uOiBEYXRhUG9pbnRQb3NpdGlvbik6IGFueSB7XG4gICAgaWYgKHBvc2l0aW9uLnJvdyA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgZGF0YVRhYmxlID0gdGhpcy53cmFwcGVyLmdldERhdGFUYWJsZSgpO1xuICAgIGNvbnN0IHZhbHVlID0gZGF0YVRhYmxlLmdldFZhbHVlKHBvc2l0aW9uLnJvdywgcG9zaXRpb24uY29sdW1uKTtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICBwcml2YXRlIGdldENvbHVtblR5cGVBdFBvc2l0aW9uKHBvc2l0aW9uOiBEYXRhUG9pbnRQb3NpdGlvbik6IHN0cmluZyB7XG4gICAgICBjb25zdCBkYXRhVGFibGUgPSB0aGlzLndyYXBwZXIuZ2V0RGF0YVRhYmxlKCk7XG4gICAgICBjb25zdCB0eXBlID0gZGF0YVRhYmxlLmdldENvbHVtblR5cGUocG9zaXRpb24uY29sdW1uKSB8fCAnJztcbiAgICAgIHJldHVybiB0eXBlO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb2x1bW5MYWJlbEF0UG9zaXRpb24ocG9zaXRpb246IERhdGFQb2ludFBvc2l0aW9uKTogc3RyaW5nIHtcbiAgICAgIGNvbnN0IGRhdGFUYWJsZSA9IHRoaXMud3JhcHBlci5nZXREYXRhVGFibGUoKTtcbiAgICAgIGNvbnN0IHR5cGUgPSBkYXRhVGFibGUuZ2V0Q29sdW1uTGFiZWwocG9zaXRpb24uY29sdW1uKSB8fCAnJztcbiAgICAgIHJldHVybiB0eXBlO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRIVE1MVG9vbHRpcCgpOiBDaGFydEhUTUxUb29sdGlwIHtcbiAgICBjb25zdCB0b29sdGlwRVIgPSBuZXcgRWxlbWVudFJlZih0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignLmdvb2dsZS12aXN1YWxpemF0aW9uLXRvb2x0aXAnKSk7XG4gICAgcmV0dXJuIG5ldyBDaGFydEhUTUxUb29sdGlwKHRvb2x0aXBFUik7XG4gIH1cblxuICBwcml2YXRlIHBhcnNlTW91c2VFdmVudChpdGVtOiBEYXRhUG9pbnRQb3NpdGlvbik6IENoYXJ0TW91c2VFdmVudCB7XG4gICAgY29uc3QgY2hhcnRUeXBlID0gdGhpcy53cmFwcGVyLmdldENoYXJ0VHlwZSgpO1xuICAgIGxldCBldmVudENvbHVtbiA9IGl0ZW0uY29sdW1uO1xuICAgIGlmIChldmVudENvbHVtbiA9PSBudWxsKSB7XG4gICAgICBzd2l0Y2ggKGNoYXJ0VHlwZSkge1xuICAgICAgICBjYXNlICdUaW1lbGluZSc6XG4gICAgICAgICAgZXZlbnRDb2x1bW4gPSB0aGlzLndyYXBwZXIuZ2V0RGF0YVRhYmxlKCkuZ2V0TnVtYmVyT2ZDb2x1bW5zKCkgPT09IDMgPyAwIDogMTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBldmVudENvbHVtbiA9IDA7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGV2ZW50Um93ID0gaXRlbS5yb3c7XG4gICAgY29uc3QgbXlJdGVtID0ge1xuICAgICAgcm93OiBldmVudFJvdyxcbiAgICAgIGNvbHVtbjogZXZlbnRDb2x1bW5cbiAgICB9O1xuICAgIGNvbnN0IGV2ZW50ID0ge1xuICAgICAgcG9zaXRpb246IGl0ZW0sXG4gICAgICBib3VuZGluZ0JveDogdGhpcy5nZXRCb3VuZGluZ0JveEZvckl0ZW0obXlJdGVtKSxcbiAgICAgIHZhbHVlOiB0aGlzLmdldFZhbHVlQXRQb3NpdGlvbihteUl0ZW0pLFxuICAgICAgY29sdW1uVHlwZTogdGhpcy5nZXRDb2x1bW5UeXBlQXRQb3NpdGlvbihteUl0ZW0pLFxuICAgICAgY29sdW1uTGFiZWw6IHRoaXMuZ2V0Q29sdW1uTGFiZWxBdFBvc2l0aW9uKG15SXRlbSlcbiAgICB9O1xuICAgIHJldHVybiBldmVudDtcbiAgfVxuXG4gIHByaXZhdGUgdW5yZWdpc3RlckV2ZW50cygpOiB2b2lkIHtcbiAgICBnb29nbGUudmlzdWFsaXphdGlvbi5ldmVudHMucmVtb3ZlQWxsTGlzdGVuZXJzKHRoaXMud3JhcHBlci5nZXRDaGFydCgpKTtcbiAgICBnb29nbGUudmlzdWFsaXphdGlvbi5ldmVudHMucmVtb3ZlQWxsTGlzdGVuZXJzKHRoaXMud3JhcHBlcik7XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyQ2hhcnRFdmVudHMoKTogdm9pZCB7XG4gICAgY29uc3QgY2hhcnQgPSB0aGlzLndyYXBwZXIuZ2V0Q2hhcnQoKTtcbiAgICB0aGlzLmNsaSA9IGNoYXJ0LmdldENoYXJ0TGF5b3V0SW50ZXJmYWNlID8gY2hhcnQuZ2V0Q2hhcnRMYXlvdXRJbnRlcmZhY2UoKSA6IG51bGw7XG4gICAgaWYgKHRoaXMubW91c2VPdmVyLm9ic2VydmVycy5sZW5ndGggPiAwKSB7XG4gICAgICBnb29nbGUudmlzdWFsaXphdGlvbi5ldmVudHMuYWRkTGlzdGVuZXIoY2hhcnQsICdvbm1vdXNlb3ZlcicsIChpdGVtOiBEYXRhUG9pbnRQb3NpdGlvbikgPT4ge1xuICAgICAgICBjb25zdCBldmVudDogQ2hhcnRNb3VzZU92ZXJFdmVudCA9IHRoaXMucGFyc2VNb3VzZUV2ZW50KGl0ZW0pIGFzIENoYXJ0TW91c2VPdmVyRXZlbnQ7XG4gICAgICAgIGV2ZW50LnRvb2x0aXAgPSB0aGlzLmdldEhUTUxUb29sdGlwKCk7XG4gICAgICAgIHRoaXMubW91c2VPdmVyLmVtaXQoZXZlbnQpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICh0aGlzLm1vdXNlT3Zlck9uZVRpbWUub2JzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRPbmVUaW1lTGlzdGVuZXIoY2hhcnQsICdvbm1vdXNlb3ZlcicsIChpdGVtOiBEYXRhUG9pbnRQb3NpdGlvbikgPT4ge1xuICAgICAgICBjb25zdCBldmVudDogQ2hhcnRNb3VzZU92ZXJFdmVudCA9IHRoaXMucGFyc2VNb3VzZUV2ZW50KGl0ZW0pIGFzIENoYXJ0TW91c2VPdmVyRXZlbnQ7XG4gICAgICAgIGV2ZW50LnRvb2x0aXAgPSB0aGlzLmdldEhUTUxUb29sdGlwKCk7XG4gICAgICAgIHRoaXMubW91c2VPdmVyT25lVGltZS5lbWl0KGV2ZW50KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm1vdXNlT3V0Lm9ic2VydmVycy5sZW5ndGggPiAwKSB7XG4gICAgICBnb29nbGUudmlzdWFsaXphdGlvbi5ldmVudHMuYWRkTGlzdGVuZXIoY2hhcnQsICdvbm1vdXNlb3V0JywgKGl0ZW06IERhdGFQb2ludFBvc2l0aW9uKSA9PiB7XG4gICAgICAgIGNvbnN0IGV2ZW50OiBDaGFydE1vdXNlT3V0RXZlbnQgPSB0aGlzLnBhcnNlTW91c2VFdmVudChpdGVtKSBhcyBDaGFydE1vdXNlT3V0RXZlbnQ7XG4gICAgICAgIHRoaXMubW91c2VPdXQuZW1pdChldmVudCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5tb3VzZU91dE9uZVRpbWUub2JzZXJ2ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRPbmVUaW1lTGlzdGVuZXIoY2hhcnQsICdvbm1vdXNlb3V0JywgKGl0ZW06IERhdGFQb2ludFBvc2l0aW9uKSA9PiB7XG4gICAgICAgIGNvbnN0IGV2ZW50OiBDaGFydE1vdXNlT3V0RXZlbnQgPSB0aGlzLnBhcnNlTW91c2VFdmVudChpdGVtKSBhcyBDaGFydE1vdXNlT3V0RXZlbnQ7XG4gICAgICAgIHRoaXMubW91c2VPdXRPbmVUaW1lLmVtaXQoZXZlbnQpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGF0YS5jaGFydFR5cGUgPT09ICdHZW9DaGFydCcpIHtcbiAgICAgIGlmICh0aGlzLnJlZ2lvbkNsaWNrLm9ic2VydmVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRMaXN0ZW5lcihjaGFydCwgJ3JlZ2lvbkNsaWNrJywgKGl0ZW06IFJlZ2lvbkNsaWNrRXZlbnQpID0+IHtcbiAgICAgICAgICB0aGlzLnJlZ2lvbkNsaWNrLmVtaXQoaXRlbSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMucmVnaW9uQ2xpY2tPbmVUaW1lLm9ic2VydmVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRPbmVUaW1lTGlzdGVuZXIoY2hhcnQsICdyZWdpb25DbGljaycsIChpdGVtOiBSZWdpb25DbGlja0V2ZW50KSA9PiB7XG4gICAgICAgICAgdGhpcy5yZWdpb25DbGljay5lbWl0KGl0ZW0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlZ2lzdGVyQ2hhcnRXcmFwcGVyRXZlbnRzKCk6IHZvaWQge1xuICAgIGdvb2dsZS52aXN1YWxpemF0aW9uLmV2ZW50cy5hZGRMaXN0ZW5lcih0aGlzLndyYXBwZXIsICdyZWFkeScsICgpID0+IHtcbiAgICAgIHRoaXMuY2hhcnRSZWFkeS5lbWl0KHttZXNzYWdlOiAnQ2hhcnQgcmVhZHknfSk7XG4gICAgfSk7XG5cbiAgICBnb29nbGUudmlzdWFsaXphdGlvbi5ldmVudHMuYWRkT25lVGltZUxpc3RlbmVyKHRoaXMud3JhcHBlciwgJ3JlYWR5JywgKCkgPT4ge1xuICAgICAgdGhpcy5jaGFydFJlYWR5T25lVGltZS5lbWl0KHttZXNzYWdlOiAnQ2hhcnQgcmVhZHkgKG9uZSB0aW1lKSd9KTtcbiAgICAgIHRoaXMucmVnaXN0ZXJDaGFydEV2ZW50cygpO1xuICAgIH0pO1xuXG4gICAgZ29vZ2xlLnZpc3VhbGl6YXRpb24uZXZlbnRzLmFkZExpc3RlbmVyKHRoaXMud3JhcHBlciwgJ2Vycm9yJywgKGVycm9yOiBhbnkpID0+IHtcbiAgICAgIHRoaXMuY2hhcnRFcnJvci5lbWl0KGVycm9yIGFzIENoYXJ0RXJyb3JFdmVudCk7XG4gICAgfSk7XG5cbiAgICBnb29nbGUudmlzdWFsaXphdGlvbi5ldmVudHMuYWRkT25lVGltZUxpc3RlbmVyKHRoaXMud3JhcHBlciwgJ2Vycm9yJywgKGVycm9yOiBhbnkpID0+IHtcbiAgICAgIHRoaXMuY2hhcnRFcnJvck9uZVRpbWUuZW1pdChlcnJvciBhcyBDaGFydEVycm9yRXZlbnQpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5hZGRMaXN0ZW5lcih0aGlzLndyYXBwZXIsICdzZWxlY3QnLCB0aGlzLnNlbGVjdExpc3RlbmVyLCB0aGlzLmNoYXJ0U2VsZWN0KTtcbiAgICB0aGlzLmFkZE9uZVRpbWVMaXN0ZW5lcih0aGlzLndyYXBwZXIsICdzZWxlY3QnLCB0aGlzLnNlbGVjdExpc3RlbmVyLCB0aGlzLmNoYXJ0U2VsZWN0T25lVGltZSk7XG4gIH1cblxuICBwcml2YXRlIGFkZExpc3RlbmVyKHNvdXJjZTogYW55LCBldmVudFR5cGU6IHN0cmluZywgbGlzdGVuZXJGbjogYW55LCBldkVtaXR0ZXI6IEV2ZW50RW1pdHRlcjxhbnk+KSB7XG4gICAgZ29vZ2xlLnZpc3VhbGl6YXRpb24uZXZlbnRzLmFkZExpc3RlbmVyKHNvdXJjZSwgZXZlbnRUeXBlLCAoKSA9PiB7XG4gICAgICBldkVtaXR0ZXIuZW1pdChsaXN0ZW5lckZuKCkpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRPbmVUaW1lTGlzdGVuZXIoc291cmNlOiBhbnksIGV2ZW50VHlwZTogc3RyaW5nLCBsaXN0ZW5lckZuOiBhbnksIGV2RW1pdHRlcjogRXZlbnRFbWl0dGVyPGFueT4pIHtcbiAgICBnb29nbGUudmlzdWFsaXphdGlvbi5ldmVudHMuYWRkT25lVGltZUxpc3RlbmVyKHNvdXJjZSwgZXZlbnRUeXBlLCAoKSA9PiB7XG4gICAgICBldkVtaXR0ZXIuZW1pdChsaXN0ZW5lckZuKCkpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBtb3VzZU92ZXJMaXN0ZW5lciA9IChpdGVtOiBEYXRhUG9pbnRQb3NpdGlvbikgPT4ge1xuICAgIGNvbnN0IGV2ZW50OiBDaGFydE1vdXNlT3ZlckV2ZW50ID0gdGhpcy5wYXJzZU1vdXNlRXZlbnQoaXRlbSkgYXMgQ2hhcnRNb3VzZU92ZXJFdmVudDtcbiAgICBldmVudC50b29sdGlwID0gdGhpcy5nZXRIVE1MVG9vbHRpcCgpO1xuICAgIHJldHVybiBldmVudDtcbiAgfVxuXG4gIHByaXZhdGUgbW91c2VPdXRMaXN0ZW5lciA9IChpdGVtOiBEYXRhUG9pbnRQb3NpdGlvbikgPT4ge1xuICAgIGNvbnN0IGV2ZW50OiBDaGFydE1vdXNlT3V0RXZlbnQgPSB0aGlzLnBhcnNlTW91c2VFdmVudChpdGVtKSBhcyBDaGFydE1vdXNlT3V0RXZlbnQ7XG4gICAgcmV0dXJuIGV2ZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBzZWxlY3RMaXN0ZW5lciA9ICgpID0+IHtcbiAgICBjb25zdCBldmVudDogQ2hhcnRTZWxlY3RFdmVudCA9IHtcbiAgICAgIG1lc3NhZ2U6ICdzZWxlY3QnLFxuICAgICAgcm93OiBudWxsLFxuICAgICAgY29sdW1uOiBudWxsLFxuICAgICAgc2VsZWN0ZWRSb3dWYWx1ZXM6IFtdLFxuICAgICAgc2VsZWN0ZWRSb3dGb3JtYXR0ZWRWYWx1ZXM6IFtdLFxuICAgICAgY29sdW1uTGFiZWw6ICcnXG4gICAgfTtcbiAgICBjb25zdCBzID0gdGhpcy53cmFwcGVyLnZpc3VhbGl6YXRpb24uZ2V0U2VsZWN0aW9uKCk7XG4gICAgY29uc3QgZ3MgPSBzW3MubGVuZ3RoIC0gMV07XG4gICAgaWYgKCFncykge1xuICAgICAgZXZlbnQubWVzc2FnZSA9ICdkZXNlbGVjdCc7XG4gICAgICByZXR1cm4gZXZlbnQ7XG4gICAgfVxuICAgIGNvbnN0IHNlbGVjdGlvbjogRGF0YVBvaW50UG9zaXRpb24gPSBncztcbiAgICBpZiAoZ3Mucm93ICE9IG51bGwpIHtcbiAgICAgIGV2ZW50LnJvdyA9IHNlbGVjdGlvbi5yb3c7XG5cbiAgICAgIGNvbnN0IHNlbGVjdGVkUm93VmFsdWVzID0gW107XG4gICAgICBjb25zdCBzZWxlY3RlZFJvd0Zvcm1hdHRlZFZhbHVlcyA9IFtdO1xuICAgICAgY29uc3QgZGF0YVRhYmxlID0gdGhpcy53cmFwcGVyLmdldERhdGFUYWJsZSgpO1xuICAgICAgY29uc3QgbnVtYmVyT2ZDb2x1bW5zID0gZGF0YVRhYmxlLmdldE51bWJlck9mQ29sdW1ucygpO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1iZXJPZkNvbHVtbnM7IGkrKykge1xuICAgICAgICBzZWxlY3RlZFJvd1ZhbHVlcy5wdXNoKGRhdGFUYWJsZS5nZXRWYWx1ZShzZWxlY3Rpb24ucm93LCBpKSk7XG4gICAgICAgIHNlbGVjdGVkUm93Rm9ybWF0dGVkVmFsdWVzLnB1c2goZGF0YVRhYmxlLmdldEZvcm1hdHRlZFZhbHVlKHNlbGVjdGlvbi5yb3csIGkpKTtcbiAgICAgIH1cbiAgICAgIGV2ZW50LnNlbGVjdGVkUm93VmFsdWVzID0gc2VsZWN0ZWRSb3dWYWx1ZXM7XG4gICAgICBldmVudC5zZWxlY3RlZFJvd0Zvcm1hdHRlZFZhbHVlcyA9IHNlbGVjdGVkUm93Rm9ybWF0dGVkVmFsdWVzO1xuICAgIH1cbiAgICBpZiAoc2VsZWN0aW9uLmNvbHVtbiAhPSBudWxsKSB7XG4gICAgICBldmVudC5jb2x1bW4gPSBzZWxlY3Rpb24uY29sdW1uO1xuICAgICAgZXZlbnQuY29sdW1uTGFiZWwgPSB0aGlzLmdldENvbHVtbkxhYmVsQXRQb3NpdGlvbihzZWxlY3Rpb24pO1xuICAgIH1cbiAgICBpZiAoZ3MubmFtZSkge1xuICAgICAgZXZlbnQuY29sdW1uTGFiZWwgPSBncy5uYW1lO1xuICAgIH1cblxuICAgIHJldHVybiBldmVudDtcbiAgfVxuXG4gIHByaXZhdGUgY29udmVydE9wdGlvbnMoKSB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMub3B0aW9ucyA9IGdvb2dsZS5jaGFydHNbdGhpcy5kYXRhLmNoYXJ0VHlwZV0uY29udmVydE9wdGlvbnModGhpcy5vcHRpb25zKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxufVxuIl19