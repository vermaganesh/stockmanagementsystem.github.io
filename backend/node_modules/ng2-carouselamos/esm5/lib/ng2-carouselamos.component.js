/**
 * @fileoverview added by tsickle
 * Generated from: lib/ng2-carouselamos.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, TemplateRef, ViewChild, ElementRef } from "@angular/core";
import isEqual from "lodash.isequal";
/**
 * @record
 */
export function SelectedItemInterface() { }
if (false) {
    /** @type {?} */
    SelectedItemInterface.prototype.item;
    /** @type {?} */
    SelectedItemInterface.prototype.index;
    /** @type {?} */
    SelectedItemInterface.prototype.first;
}
var Ng2CarouselamosComponent = /** @class */ (function () {
    function Ng2CarouselamosComponent() {
        this.childIndex = 0;
        this.amount = 0;
        this.startPress = 0;
        this.lastX = 0;
        this.startAt = 0;
        this.items = [];
        this.width = 500;
        this.onSelectedItem = new EventEmitter();
    }
    /**
     * @param {?} e
     * @return {?}
     */
    Ng2CarouselamosComponent.prototype.onMousedown = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        if (e.which === 1) {
            this.startPress = e.clientX;
            this.lastX = this.amount;
        }
    };
    /**
     * @param {?} e
     * @return {?}
     */
    Ng2CarouselamosComponent.prototype.onTouchdown = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        if (navigator.userAgent.indexOf("Android") >= 0)
            e.preventDefault();
        this.startPress = e.targetTouches[0].clientX;
        this.lastX = this.amount;
    };
    /**
     * @param {?} e
     * @param {?} maxWidth
     * @return {?}
     */
    Ng2CarouselamosComponent.prototype.onMousemove = /**
     * @param {?} e
     * @param {?} maxWidth
     * @return {?}
     */
    function (e, maxWidth) {
        if (e.which === 1) {
            /** @type {?} */
            var amount = this.lastX - (this.startPress - e.clientX);
            if (amount > 0 || amount < -(maxWidth - this.width))
                return;
            this.amount = amount;
        }
    };
    /**
     * @param {?} e
     * @param {?} maxWidth
     * @return {?}
     */
    Ng2CarouselamosComponent.prototype.onTouchmove = /**
     * @param {?} e
     * @param {?} maxWidth
     * @return {?}
     */
    function (e, maxWidth) {
        if (navigator.userAgent.indexOf("Android") >= 0)
            e.preventDefault();
        /** @type {?} */
        var amount = this.lastX - (this.startPress - e.targetTouches[0].clientX);
        if (amount > 0 || amount < -(maxWidth - this.width))
            return;
        this.amount = amount;
    };
    /**
     * @param {?} e
     * @param {?} elem
     * @return {?}
     */
    Ng2CarouselamosComponent.prototype.onMouseup = /**
     * @param {?} e
     * @param {?} elem
     * @return {?}
     */
    function (e, elem) {
        if (e.which === 1) {
            this.startPress = 0;
            this.snap(elem);
        }
    };
    /**
     * @param {?} e
     * @param {?} elem
     * @return {?}
     */
    Ng2CarouselamosComponent.prototype.onTouchup = /**
     * @param {?} e
     * @param {?} elem
     * @return {?}
     */
    function (e, elem) {
        if (navigator.userAgent.indexOf("Android") >= 0)
            e.preventDefault();
        this.startPress = 0;
        this.snap(elem);
    };
    /**
     * @param {?} elem
     * @return {?}
     */
    Ng2CarouselamosComponent.prototype.snap = /**
     * @param {?} elem
     * @return {?}
     */
    function (elem) {
        /** @type {?} */
        var counter = 0;
        /** @type {?} */
        var lastVal = 0;
        for (var i = 0; i < this.items.length; i++) {
            /** @type {?} */
            var el = elem.children[i];
            /** @type {?} */
            var style = el.currentStyle || window.getComputedStyle(el);
            counter +=
                el.offsetWidth +
                    (parseFloat(style.marginLeft) + parseFloat(style.marginRight));
            if (this.amount <= lastVal && this.amount >= -counter) {
                this.amount = -lastVal;
                this.childIndex = i;
                this.onSelectedItem.emit({
                    item: this.items[this.childIndex],
                    index: this.childIndex,
                    first: false
                });
                return;
            }
            lastVal = counter;
        }
        return counter;
    };
    /**
     * @param {?} forward
     * @param {?} elem
     * @param {?=} qty
     * @return {?}
     */
    Ng2CarouselamosComponent.prototype.scroll = /**
     * @param {?} forward
     * @param {?} elem
     * @param {?=} qty
     * @return {?}
     */
    function (forward, elem, qty) {
        if (qty === void 0) { qty = 1; }
        this.childIndex += forward ? qty : -qty;
        this.onSelectedItem.emit({
            item: this.items[this.childIndex],
            index: this.childIndex,
            first: false
        });
        this.amount = -this.calcScroll(elem);
    };
    /**
     * @param {?} elem
     * @return {?}
     */
    Ng2CarouselamosComponent.prototype.calcScroll = /**
     * @param {?} elem
     * @return {?}
     */
    function (elem) {
        /** @type {?} */
        var counter = 0;
        for (var i = this.childIndex - 1; i >= 0; i--) {
            /** @type {?} */
            var el = elem.children[i];
            /** @type {?} */
            var style = el.currentStyle || window.getComputedStyle(el);
            counter +=
                el.offsetWidth +
                    (parseFloat(style.marginLeft) + parseFloat(style.marginRight));
        }
        return counter;
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    Ng2CarouselamosComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.items &&
            !isEqual(changes.items.previousValue, changes.items.currentValue)) {
            if (changes.items.firstChange) {
                this.onSelectedItem.emit({
                    item: this.items[this.childIndex],
                    index: this.childIndex,
                    first: true
                });
            }
            this.amount = 0;
        }
    };
    /**
     * @return {?}
     */
    Ng2CarouselamosComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.startPress = 1;
        this.scroll(true, this.list.nativeElement, this.startAt);
        setTimeout((/**
         * @return {?}
         */
        function () { return (_this.startPress = 0); }));
    };
    Ng2CarouselamosComponent.decorators = [
        { type: Component, args: [{
                    selector: "[ng2-carouselamos]",
                    template: "<div class=\"ng2-carouselamos-container\">\n  <div\n    class=\"ng2-carouselamos-wrapper\"\n    [style.width]=\"width + 'px'\"\n    (mousedown)=\"onMousedown($event)\"\n    (touchstart)=\"onTouchdown($event)\"\n    (mousemove)=\"onMousemove($event, list.scrollWidth)\"\n    (touchmove)=\"onTouchmove($event, list.scrollWidth)\"\n    (mouseup)=\"onMouseup($event, list)\"\n    (mouseleave)=\"onMouseup($event, list)\"\n    (touchend)=\"onTouchup($event, list)\"\n  >\n    <div\n      class=\"ng2-carouselamos\"\n      [attr.startPress]=\"startPress\"\n      [style.transition]=\"startPress > 0 ? 'none' : '-webkit-transform 1s'\"\n      [style.webkitTransition]=\"\n        startPress > 0 ? 'none' : '-webkit-transform 1s'\n      \"\n      [style.transform]=\"'translateX(' + amount + 'px)'\"\n      [style.webkitTransform]=\"'translateX(' + amount + 'px)'\"\n      #list\n    >\n      <ng-template\n        *ngFor=\"let item of items; let i = index\"\n        [ngTemplateOutlet]=\"$item\"\n        [ngTemplateOutletContext]=\"{\n          $implicit: item,\n          index: i,\n          selectedIndex: childIndex\n        }\"\n      ></ng-template>\n    </div>\n  </div>\n  <div class=\"controls\" *ngIf=\"$prev || $next\">\n    <button\n      type=\"button\"\n      *ngIf=\"$prev\"\n      (click)=\"scroll(false, list)\"\n      [disabled]=\"amount >= 0\"\n    >\n      <ng-template [ngTemplateOutlet]=\"$prev\"></ng-template>\n    </button>\n    <button\n      type=\"button\"\n      *ngIf=\"$next\"\n      (click)=\"scroll(true, list)\"\n      [disabled]=\"amount <= -(list.scrollWidth - width)\"\n    >\n      <ng-template [ngTemplateOutlet]=\"$next\"></ng-template>\n    </button>\n  </div>\n</div>\n",
                    styles: [".ng2-carouselamos-container{position:relative;display:flex;justify-content:center}.ng2-carouselamos-wrapper{overflow:hidden}.ng2-carouselamos{display:flex;transition:transform 1s}.controls{pointer-events:none;position:absolute;display:flex;width:100%;justify-content:space-between;top:50%;left:0;transform:translateY(-50%)}.controls button{pointer-events:all;background:0 0;border:0}"]
                }] }
    ];
    Ng2CarouselamosComponent.propDecorators = {
        startAt: [{ type: Input }],
        items: [{ type: Input }],
        width: [{ type: Input }],
        $prev: [{ type: Input }],
        $next: [{ type: Input }],
        $item: [{ type: Input }],
        onSelectedItem: [{ type: Output }],
        list: [{ type: ViewChild, args: ["list", { static: true },] }]
    };
    return Ng2CarouselamosComponent;
}());
export { Ng2CarouselamosComponent };
if (false) {
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.childIndex;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.amount;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.startPress;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.lastX;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.startAt;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.items;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.width;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.$prev;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.$next;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.$item;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.onSelectedItem;
    /** @type {?} */
    Ng2CarouselamosComponent.prototype.list;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmcyLWNhcm91c2VsYW1vcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZzItY2Fyb3VzZWxhbW9zLyIsInNvdXJjZXMiOlsibGliL25nMi1jYXJvdXNlbGFtb3MuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFDWixXQUFXLEVBRVgsU0FBUyxFQUNULFVBQVUsRUFFWCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLE9BQU8sTUFBTSxnQkFBZ0IsQ0FBQzs7OztBQUVyQywyQ0FJQzs7O0lBSEMscUNBQVU7O0lBQ1Ysc0NBQWM7O0lBQ2Qsc0NBQWU7O0FBR2pCO0lBQUE7UUFlRSxlQUFVLEdBQVcsQ0FBQyxDQUFDO1FBQ3ZCLFdBQU0sR0FBVyxDQUFDLENBQUM7UUFDbkIsZUFBVSxHQUFXLENBQUMsQ0FBQztRQUN2QixVQUFLLEdBQVcsQ0FBQyxDQUFDO1FBR2xCLFlBQU8sR0FBRyxDQUFDLENBQUM7UUFHWixVQUFLLEdBQWUsRUFBRSxDQUFDO1FBR3ZCLFVBQUssR0FBVyxHQUFHLENBQUM7UUFZcEIsbUJBQWMsR0FBd0MsSUFBSSxZQUFZLEVBQUUsQ0FBQztJQStHM0UsQ0FBQzs7Ozs7SUExR0MsOENBQVc7Ozs7SUFBWCxVQUFZLENBQWE7UUFDdkIsSUFBSSxDQUFDLENBQUMsS0FBSyxLQUFLLENBQUMsRUFBRTtZQUNqQixJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUM7WUFDNUIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1NBQzFCO0lBQ0gsQ0FBQzs7Ozs7SUFDRCw4Q0FBVzs7OztJQUFYLFVBQVksQ0FBYTtRQUN2QixJQUFJLFNBQVMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUM7WUFBRSxDQUFDLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDcEUsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUM3QyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDM0IsQ0FBQzs7Ozs7O0lBRUQsOENBQVc7Ozs7O0lBQVgsVUFBWSxDQUFhLEVBQUUsUUFBZ0I7UUFDekMsSUFBSSxDQUFDLENBQUMsS0FBSyxLQUFLLENBQUMsRUFBRTs7Z0JBQ1gsTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUM7WUFDekQsSUFBSSxNQUFNLEdBQUcsQ0FBQyxJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7Z0JBQUUsT0FBTztZQUM1RCxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztTQUN0QjtJQUNILENBQUM7Ozs7OztJQUNELDhDQUFXOzs7OztJQUFYLFVBQVksQ0FBYSxFQUFFLFFBQWdCO1FBQ3pDLElBQUksU0FBUyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQztZQUFFLENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQzs7WUFDOUQsTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1FBQzFFLElBQUksTUFBTSxHQUFHLENBQUMsSUFBSSxNQUFNLEdBQUcsQ0FBQyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBQUUsT0FBTztRQUM1RCxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN2QixDQUFDOzs7Ozs7SUFFRCw0Q0FBUzs7Ozs7SUFBVCxVQUFVLENBQWEsRUFBRSxJQUFTO1FBQ2hDLElBQUksQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLEVBQUU7WUFDakIsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7WUFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNqQjtJQUNILENBQUM7Ozs7OztJQUVELDRDQUFTOzs7OztJQUFULFVBQVUsQ0FBYSxFQUFFLElBQVM7UUFDaEMsSUFBSSxTQUFTLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDO1lBQUUsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3BFLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDO1FBQ3BCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbEIsQ0FBQzs7Ozs7SUFFRCx1Q0FBSTs7OztJQUFKLFVBQUssSUFBUzs7WUFDUixPQUFPLEdBQUcsQ0FBQzs7WUFDWCxPQUFPLEdBQUcsQ0FBQztRQUNmLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTs7Z0JBQ3BDLEVBQUUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQzs7Z0JBQ3JCLEtBQUssR0FBRyxFQUFFLENBQUMsWUFBWSxJQUFJLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLENBQUM7WUFDNUQsT0FBTztnQkFDTCxFQUFFLENBQUMsV0FBVztvQkFDZCxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ2pFLElBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxPQUFPLElBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLE9BQU8sRUFBRTtnQkFDckQsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLE9BQU8sQ0FBQztnQkFDdkIsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7Z0JBQ3BCLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDO29CQUN2QixJQUFJLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO29CQUNqQyxLQUFLLEVBQUUsSUFBSSxDQUFDLFVBQVU7b0JBQ3RCLEtBQUssRUFBRSxLQUFLO2lCQUNiLENBQUMsQ0FBQztnQkFDSCxPQUFPO2FBQ1I7WUFDRCxPQUFPLEdBQUcsT0FBTyxDQUFDO1NBQ25CO1FBQ0QsT0FBTyxPQUFPLENBQUM7SUFDakIsQ0FBQzs7Ozs7OztJQUVELHlDQUFNOzs7Ozs7SUFBTixVQUFPLE9BQWdCLEVBQUUsSUFBUyxFQUFFLEdBQU87UUFBUCxvQkFBQSxFQUFBLE9BQU87UUFDekMsSUFBSSxDQUFDLFVBQVUsSUFBSSxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7UUFDeEMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUM7WUFDdkIsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQztZQUNqQyxLQUFLLEVBQUUsSUFBSSxDQUFDLFVBQVU7WUFDdEIsS0FBSyxFQUFFLEtBQUs7U0FDYixDQUFDLENBQUM7UUFDSCxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN2QyxDQUFDOzs7OztJQUVELDZDQUFVOzs7O0lBQVYsVUFBVyxJQUFTOztZQUNkLE9BQU8sR0FBRyxDQUFDO1FBQ2YsS0FBSyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFOztnQkFDdkMsRUFBRSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDOztnQkFDckIsS0FBSyxHQUFHLEVBQUUsQ0FBQyxZQUFZLElBQUksTUFBTSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQztZQUM1RCxPQUFPO2dCQUNMLEVBQUUsQ0FBQyxXQUFXO29CQUNkLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7U0FDbEU7UUFDRCxPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDOzs7OztJQUVELDhDQUFXOzs7O0lBQVgsVUFBWSxPQUFzQjtRQUNoQyxJQUNFLE9BQU8sQ0FBQyxLQUFLO1lBQ2IsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxhQUFhLEVBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsRUFDakU7WUFDQSxJQUFJLE9BQU8sQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFO2dCQUM3QixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQztvQkFDdkIsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQztvQkFDakMsS0FBSyxFQUFFLElBQUksQ0FBQyxVQUFVO29CQUN0QixLQUFLLEVBQUUsSUFBSTtpQkFDWixDQUFDLENBQUM7YUFDSjtZQUNELElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1NBQ2pCO0lBQ0gsQ0FBQzs7OztJQUVELGtEQUFlOzs7SUFBZjtRQUFBLGlCQUlDO1FBSEMsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7UUFDcEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3pELFVBQVU7OztRQUFDLGNBQU0sT0FBQSxDQUFDLEtBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLEVBQXJCLENBQXFCLEVBQUMsQ0FBQztJQUMxQyxDQUFDOztnQkFySkYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxvQkFBb0I7b0JBRTlCLHFyREFBZ0Q7O2lCQUNqRDs7OzBCQWdCRSxLQUFLO3dCQUdMLEtBQUs7d0JBR0wsS0FBSzt3QkFHTCxLQUFLO3dCQUdMLEtBQUs7d0JBR0wsS0FBSztpQ0FHTCxNQUFNO3VCQUdOLFNBQVMsU0FBQyxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOztJQTZHckMsK0JBQUM7Q0FBQSxBQXRKRCxJQXNKQztTQXhJWSx3QkFBd0I7OztJQUNuQyw4Q0FBdUI7O0lBQ3ZCLDBDQUFtQjs7SUFDbkIsOENBQXVCOztJQUN2Qix5Q0FBa0I7O0lBRWxCLDJDQUNZOztJQUVaLHlDQUN1Qjs7SUFFdkIseUNBQ29COztJQUVwQix5Q0FDd0I7O0lBRXhCLHlDQUN3Qjs7SUFFeEIseUNBQ3dCOztJQUV4QixrREFDeUU7O0lBRXpFLHdDQUNpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBUZW1wbGF0ZVJlZixcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgVmlld0NoaWxkLFxuICBFbGVtZW50UmVmLFxuICBBZnRlclZpZXdJbml0XG59IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQgaXNFcXVhbCBmcm9tIFwibG9kYXNoLmlzZXF1YWxcIjtcblxuZXhwb3J0IGludGVyZmFjZSBTZWxlY3RlZEl0ZW1JbnRlcmZhY2Uge1xuICBpdGVtOiBhbnk7XG4gIGluZGV4OiBudW1iZXI7XG4gIGZpcnN0OiBib29sZWFuO1xufVxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6IFwiW25nMi1jYXJvdXNlbGFtb3NdXCIsXG4gIHN0eWxlVXJsczogW1wiLi9uZzItY2Fyb3VzZWxhbW9zLmNvbXBvbmVudC5zY3NzXCJdLFxuICB0ZW1wbGF0ZVVybDogXCIuL25nMi1jYXJvdXNlbGFtb3MuY29tcG9uZW50Lmh0bWxcIlxufSlcbi8qXG4gKlxuICogQHBhcmFtKCkgc3RhcnRBdCAtIGluZGV4IG9mIHNsaWRlIHRvIHJlbmRlciBmaXJzdC4gRGVmYXVsdCB0byAwLlxuICogQHBhcmFtKCkgaXRlbXMgLSBMaXN0IG9mIGl0ZW1zIHRvIGJlbG9uZyBpbiBjYXJvdXNlbFxuICogQHBhcmFtKCkgd2lkdGggLSBTaXplIG9mIHdpbmRvdyh2aWV3KSB0byBzaG93XG4gKiBAcGFyYW0oKSAkcHJldiAtIFRlbXBsYXRlIGZvciBwcmV2aW91cyBidXR0b25cbiAqIEBwYXJhbSgpICRuZXh0IC0gVGVtcGxhdGUgZm9yIG5leHQgYnV0dG9uXG4gKiBAcGFyYW0oKSAkaXRlbSAtIFRlbXBsYXRlIGZvciB0aGUgaXRlbVxuICovXG5leHBvcnQgY2xhc3MgTmcyQ2Fyb3VzZWxhbW9zQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCB7XG4gIGNoaWxkSW5kZXg6IG51bWJlciA9IDA7XG4gIGFtb3VudDogbnVtYmVyID0gMDtcbiAgc3RhcnRQcmVzczogbnVtYmVyID0gMDtcbiAgbGFzdFg6IG51bWJlciA9IDA7XG5cbiAgQElucHV0KClcbiAgc3RhcnRBdCA9IDA7XG5cbiAgQElucHV0KClcbiAgaXRlbXM6IEFycmF5PGFueT4gPSBbXTtcblxuICBASW5wdXQoKVxuICB3aWR0aDogbnVtYmVyID0gNTAwO1xuXG4gIEBJbnB1dCgpXG4gICRwcmV2OiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIEBJbnB1dCgpXG4gICRuZXh0OiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIEBJbnB1dCgpXG4gICRpdGVtOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIEBPdXRwdXQoKVxuICBvblNlbGVjdGVkSXRlbTogRXZlbnRFbWl0dGVyPFNlbGVjdGVkSXRlbUludGVyZmFjZT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgQFZpZXdDaGlsZChcImxpc3RcIiwgeyBzdGF0aWM6IHRydWUgfSlcbiAgbGlzdDogRWxlbWVudFJlZjtcblxuICBvbk1vdXNlZG93bihlOiBNb3VzZUV2ZW50KSB7XG4gICAgaWYgKGUud2hpY2ggPT09IDEpIHtcbiAgICAgIHRoaXMuc3RhcnRQcmVzcyA9IGUuY2xpZW50WDtcbiAgICAgIHRoaXMubGFzdFggPSB0aGlzLmFtb3VudDtcbiAgICB9XG4gIH1cbiAgb25Ub3VjaGRvd24oZTogVG91Y2hFdmVudCkge1xuICAgIGlmIChuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJBbmRyb2lkXCIpID49IDApIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB0aGlzLnN0YXJ0UHJlc3MgPSBlLnRhcmdldFRvdWNoZXNbMF0uY2xpZW50WDtcbiAgICB0aGlzLmxhc3RYID0gdGhpcy5hbW91bnQ7XG4gIH1cblxuICBvbk1vdXNlbW92ZShlOiBNb3VzZUV2ZW50LCBtYXhXaWR0aDogbnVtYmVyKSB7XG4gICAgaWYgKGUud2hpY2ggPT09IDEpIHtcbiAgICAgIGNvbnN0IGFtb3VudCA9IHRoaXMubGFzdFggLSAodGhpcy5zdGFydFByZXNzIC0gZS5jbGllbnRYKTtcbiAgICAgIGlmIChhbW91bnQgPiAwIHx8IGFtb3VudCA8IC0obWF4V2lkdGggLSB0aGlzLndpZHRoKSkgcmV0dXJuO1xuICAgICAgdGhpcy5hbW91bnQgPSBhbW91bnQ7XG4gICAgfVxuICB9XG4gIG9uVG91Y2htb3ZlKGU6IFRvdWNoRXZlbnQsIG1heFdpZHRoOiBudW1iZXIpIHtcbiAgICBpZiAobmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiQW5kcm9pZFwiKSA+PSAwKSBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgYW1vdW50ID0gdGhpcy5sYXN0WCAtICh0aGlzLnN0YXJ0UHJlc3MgLSBlLnRhcmdldFRvdWNoZXNbMF0uY2xpZW50WCk7XG4gICAgaWYgKGFtb3VudCA+IDAgfHwgYW1vdW50IDwgLShtYXhXaWR0aCAtIHRoaXMud2lkdGgpKSByZXR1cm47XG4gICAgdGhpcy5hbW91bnQgPSBhbW91bnQ7XG4gIH1cblxuICBvbk1vdXNldXAoZTogTW91c2VFdmVudCwgZWxlbTogYW55KSB7XG4gICAgaWYgKGUud2hpY2ggPT09IDEpIHtcbiAgICAgIHRoaXMuc3RhcnRQcmVzcyA9IDA7XG4gICAgICB0aGlzLnNuYXAoZWxlbSk7XG4gICAgfVxuICB9XG5cbiAgb25Ub3VjaHVwKGU6IFRvdWNoRXZlbnQsIGVsZW06IGFueSkge1xuICAgIGlmIChuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJBbmRyb2lkXCIpID49IDApIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB0aGlzLnN0YXJ0UHJlc3MgPSAwO1xuICAgIHRoaXMuc25hcChlbGVtKTtcbiAgfVxuXG4gIHNuYXAoZWxlbTogYW55KSB7XG4gICAgbGV0IGNvdW50ZXIgPSAwO1xuICAgIGxldCBsYXN0VmFsID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGVsID0gZWxlbS5jaGlsZHJlbltpXTtcbiAgICAgIGNvbnN0IHN0eWxlID0gZWwuY3VycmVudFN0eWxlIHx8IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsKTtcbiAgICAgIGNvdW50ZXIgKz1cbiAgICAgICAgZWwub2Zmc2V0V2lkdGggK1xuICAgICAgICAocGFyc2VGbG9hdChzdHlsZS5tYXJnaW5MZWZ0KSArIHBhcnNlRmxvYXQoc3R5bGUubWFyZ2luUmlnaHQpKTtcbiAgICAgIGlmICh0aGlzLmFtb3VudCA8PSBsYXN0VmFsICYmIHRoaXMuYW1vdW50ID49IC1jb3VudGVyKSB7XG4gICAgICAgIHRoaXMuYW1vdW50ID0gLWxhc3RWYWw7XG4gICAgICAgIHRoaXMuY2hpbGRJbmRleCA9IGk7XG4gICAgICAgIHRoaXMub25TZWxlY3RlZEl0ZW0uZW1pdCh7XG4gICAgICAgICAgaXRlbTogdGhpcy5pdGVtc1t0aGlzLmNoaWxkSW5kZXhdLFxuICAgICAgICAgIGluZGV4OiB0aGlzLmNoaWxkSW5kZXgsXG4gICAgICAgICAgZmlyc3Q6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsYXN0VmFsID0gY291bnRlcjtcbiAgICB9XG4gICAgcmV0dXJuIGNvdW50ZXI7XG4gIH1cblxuICBzY3JvbGwoZm9yd2FyZDogYm9vbGVhbiwgZWxlbTogYW55LCBxdHkgPSAxKSB7XG4gICAgdGhpcy5jaGlsZEluZGV4ICs9IGZvcndhcmQgPyBxdHkgOiAtcXR5O1xuICAgIHRoaXMub25TZWxlY3RlZEl0ZW0uZW1pdCh7XG4gICAgICBpdGVtOiB0aGlzLml0ZW1zW3RoaXMuY2hpbGRJbmRleF0sXG4gICAgICBpbmRleDogdGhpcy5jaGlsZEluZGV4LFxuICAgICAgZmlyc3Q6IGZhbHNlXG4gICAgfSk7XG4gICAgdGhpcy5hbW91bnQgPSAtdGhpcy5jYWxjU2Nyb2xsKGVsZW0pO1xuICB9XG5cbiAgY2FsY1Njcm9sbChlbGVtOiBhbnkpIHtcbiAgICBsZXQgY291bnRlciA9IDA7XG4gICAgZm9yIChsZXQgaSA9IHRoaXMuY2hpbGRJbmRleCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBjb25zdCBlbCA9IGVsZW0uY2hpbGRyZW5baV07XG4gICAgICBjb25zdCBzdHlsZSA9IGVsLmN1cnJlbnRTdHlsZSB8fCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbCk7XG4gICAgICBjb3VudGVyICs9XG4gICAgICAgIGVsLm9mZnNldFdpZHRoICtcbiAgICAgICAgKHBhcnNlRmxvYXQoc3R5bGUubWFyZ2luTGVmdCkgKyBwYXJzZUZsb2F0KHN0eWxlLm1hcmdpblJpZ2h0KSk7XG4gICAgfVxuICAgIHJldHVybiBjb3VudGVyO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGlmIChcbiAgICAgIGNoYW5nZXMuaXRlbXMgJiZcbiAgICAgICFpc0VxdWFsKGNoYW5nZXMuaXRlbXMucHJldmlvdXNWYWx1ZSwgY2hhbmdlcy5pdGVtcy5jdXJyZW50VmFsdWUpXG4gICAgKSB7XG4gICAgICBpZiAoY2hhbmdlcy5pdGVtcy5maXJzdENoYW5nZSkge1xuICAgICAgICB0aGlzLm9uU2VsZWN0ZWRJdGVtLmVtaXQoe1xuICAgICAgICAgIGl0ZW06IHRoaXMuaXRlbXNbdGhpcy5jaGlsZEluZGV4XSxcbiAgICAgICAgICBpbmRleDogdGhpcy5jaGlsZEluZGV4LFxuICAgICAgICAgIGZpcnN0OiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy5hbW91bnQgPSAwO1xuICAgIH1cbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLnN0YXJ0UHJlc3MgPSAxO1xuICAgIHRoaXMuc2Nyb2xsKHRydWUsIHRoaXMubGlzdC5uYXRpdmVFbGVtZW50LCB0aGlzLnN0YXJ0QXQpO1xuICAgIHNldFRpbWVvdXQoKCkgPT4gKHRoaXMuc3RhcnRQcmVzcyA9IDApKTtcbiAgfVxufVxuIl19